#!/usr/bin/env python

import unittest
from src.boulder_io_reader import BoulderIOReader
from src.sequence import Sequence

class TestBoulderIOReader(unittest.TestCase):

    def setUp(self):
        self.reader = BoulderIOReader()

    def test_entry_to_primers(self):
        entry = """SEQUENCE_ID=BDOR_000249-RB
SEQUENCE_TEMPLATE=ATGTGTGGCATATTTGCAATATTTTCAAAAAATGGCGAGCCCATAGCACCAAGAGTCTTCCATGGTAGTATGCATACTCTGCGGGAAATTGGTTATCGTCAAAGTGGTAAACAACGGCATCGAGGTCCAGATGACACGGGCGTAAAGGTGCTGCCGGATCATGGTGTAGTATTGATACATGAGCGTCTATCGGTTATTTGCGTAAAATCAGGGCATCAGCCTTTGGTTTCGGAAAACGGTGATGTGTTGTTAGTGGCAAACGGTGAAATTTACAACTACCTTGAACAGTCGGCGGAAATCGCAAAGAAGCGTGGACATTACAAACCCAAAAGTGATTGCAATGTCATTGTTGAGCTTTACGAAGAGTATGGCGAGCAACTGTTTGATTATATCACTGGTATGTTTGCCTTTGTGCTCTATGATAAACGCACGAAGAATATTTTGATTGCTCGTGATCCTTTTGGGATAATACCGTTATATATTGGTGAAGATTCAGATGGCAATGTATGGGTTTCTTCAGAAATGAAGTGCCTCGTTGAATTTTGTCCCAATTTGGAGCTTTTTAAGCCCGGCGAGCTACGAGTAGGACCGGCTAATAATTTACAGCGTAAGAAATATTTCAAAGAGGAGTGGATTGaACATATACCCACCCAACAGGTGGATTTGACAATTTTGCGCTCCAAATTAGAAACAGCTGTACGTTCCCATCTGCAGTGTGATGTTCCCTTTGGTGCGCTGCTCTCAGGCGGTGTCGATTCTAGTCTAATAGCTTCAATTGCGACAAAATTGCGCCGTGAAAGTGTTCCTACATTCCGATTAAAAACGTTTTCAGTGGGCCTGCGGAATGCACCTGATTTCAAAGCGGCGAAACTAGTTTCTGACTATATAAACAGTGATCACACCGAAATAGTTTTTGAAATAGACGATGCTTTGGATGGCATACGTGATATTATCTACCACTTGGAAACATACGATGTAACAACGGTACGTTGTAGTCTGCCAATGTTGTTATTGGCTCGTTATATTAAAAGCACTGGTATTAAGATGATTTTGTCTGGCGAAGGTGCAGATGAAATATTTGGTGGTTACTTATACTTTTTCAAAGCGCCAAGTCCAGTAGAGTTTCACAAAGAATTAGTAAAGCGAGTCGAATTAATTAATGTATCAGATTGCCTGCGAGCCAATAAAGTCACAATGGCCAAAGGTCTGGAGTTGCGGGTGCCTTTCCTGGACACAGCCTTTGTTAATTATGTGATGTCAGTCAGACCGGAAGATAAGATACCTGGTAATCTTAACTGCTTAGATAATATGCAAAAATATCGTATTGAAAAGCACATCCTACGCGCTGCATTTGCCAATAATTACCTACCTGACGAAGTACTGTGGCGGCAAAAAGAACAATTTTCTGATGGTGTCGGCTACGACTGGATTGATAGCATACGTCGCGTGGCGACCTCACATATAAGTGATGAACAGTTTGCTACAGCTGCCCTACGTTTCCCTATTAACACACCAACTACTAAGGAAGCCTATTATTATCGCACAATTTTCGAAGAGCTGTTCCCTGGTACAGCAGCAGCACAAACTGTGACACGTTGGGTGCCACGTTTGGATTGGGGATGTCCCGAAGACCCATCTGGCCGTGCTCAAGCTGTTCATCAATGTATCGTTGAAGATAAAGATAGAAATTTGGAAAAGGTGAAGCCGCCGCAACTGCGTCACTTATTGGAAAACGGGAGTGAAGCAGAAACGAAAAACGCGAATAGAGTAATTCCATACTGCATCTTAGATAACTTGTCTGCCATGCTAGGAGCTTGGTGGTTCATAATATGCGAAAGTCTCAGCATGACGGCCAATATACTGGGCGAACGCTTTCAAAGGGCACTCCGTCACATAGGTCCCGCCGCCATGGTCGCCGATTATCGCGCCTTGTGGTTACGTTTGAGCAAATTGACACGCGATACCGGCAATGCGACCTGCTATACTTTCACTTTTATCAATTTGTATCTCTTTTTTATCATCACACTCTCCGTTTACGGACTCATGTCACAGCTCTCCGAAGGCTTTGGCATTAAGGATATCGGTTTGGCTATAACGGCTATTTGGAATGTTTTTTTGCTTTTCTACATTTGCGATAAAGCTCATTACGCCTCCTTCAATGTGCGCACGAATTTCCAGAAAAAGCTGTTGATGGTCGAACTGAATTGGATGAACTCGGACGCGCAGACGGAGATAAATATGTTCATACGCGCTACGGAAATGAATCCGTCGAATATCAATTGTGGTGGATTCTTCGATGTGAACAGAAATCTTTTCAAAGGCCTGCTCACCACCATGGTCACTTATCTAGTTGTCTTGCTGCAGTTCCAAATTAGCATACCCACCGACACCGGTCGGCACATGAACGTTTCGGTGGCCGAGTTAGCCACCGACATGATGCTGGAAAGTGCTGAGGACGAACTAACCACCACCAGTACAACATCGACAACAACAACCACAACGACTAAGATGCCACCGCCGGCACGTGGCAGGAAGGGATAA
SEQUENCE_TARGET=219,1
SEQUENCE_TARGET=660,1
SEQUENCE_TARGET=774,1
SEQUENCE_TARGET=879,1
PRIMER_LEFT_EXPLAIN=considered 6223, overlap target 84, GC content failed 25, low tm 1697, high tm 2029, high hairpin stability 2, long poly-x seq 23, ok 2363
PRIMER_RIGHT_EXPLAIN=considered 17634, overlap target 84, GC content failed 99, low tm 4954, high tm 6555, long poly-x seq 42, ok 5900
PRIMER_PAIR_EXPLAIN=considered 3008, no target 6, unacceptable product size 2999, ok 3
PRIMER_LEFT_NUM_RETURNED=2
PRIMER_RIGHT_NUM_RETURNED=2
PRIMER_INTERNAL_NUM_RETURNED=0
PRIMER_PAIR_NUM_RETURNED=2
PRIMER_PAIR_0_PENALTY=0.058515
PRIMER_LEFT_0_PENALTY=0.053991
PRIMER_RIGHT_0_PENALTY=0.004524
PRIMER_LEFT_0_SEQUENCE=TGaACATATACCCACCCAACAGG
PRIMER_RIGHT_0_SEQUENCE=ATTAGACTAGAATCGACACCGCC
PRIMER_LEFT_0=635,23
PRIMER_RIGHT_0=766,23
PRIMER_LEFT_0_TM=60.054
PRIMER_RIGHT_0_TM=59.995
PRIMER_LEFT_0_GC_PERCENT=47.826
PRIMER_RIGHT_0_GC_PERCENT=47.826
PRIMER_LEFT_0_SELF_ANY_TH=0.00
PRIMER_RIGHT_0_SELF_ANY_TH=0.00
PRIMER_LEFT_0_SELF_END_TH=0.00
PRIMER_RIGHT_0_SELF_END_TH=0.00
PRIMER_LEFT_0_HAIRPIN_TH=43.78
PRIMER_RIGHT_0_HAIRPIN_TH=35.37
PRIMER_LEFT_0_END_STABILITY=4.0000
PRIMER_RIGHT_0_END_STABILITY=6.1300
PRIMER_PAIR_0_COMPL_ANY_TH=0.00
PRIMER_PAIR_0_COMPL_END_TH=0.00
PRIMER_PAIR_0_PRODUCT_SIZE=132
PRIMER_PAIR_1_PENALTY=0.070172
PRIMER_LEFT_1_PENALTY=0.004524
PRIMER_RIGHT_1_PENALTY=0.065648
PRIMER_LEFT_1_SEQUENCE=GGCGGTGTCGATTCTAGTCTAAT
PRIMER_RIGHT_1_SEQUENCE=AAACTAGTTTCGCCGCTTTGAAA
PRIMER_LEFT_1=744,23
PRIMER_RIGHT_1=876,23
PRIMER_LEFT_1_TM=59.995
PRIMER_RIGHT_1_TM=59.934
PRIMER_LEFT_1_GC_PERCENT=47.826
PRIMER_RIGHT_1_GC_PERCENT=39.130
PRIMER_LEFT_1_SELF_ANY_TH=0.00
PRIMER_RIGHT_1_SELF_ANY_TH=15.22
PRIMER_LEFT_1_SELF_END_TH=0.00
PRIMER_RIGHT_1_SELF_END_TH=0.00
PRIMER_LEFT_1_HAIRPIN_TH=39.00
PRIMER_RIGHT_1_HAIRPIN_TH=0.00
PRIMER_LEFT_1_END_STABILITY=1.7300
PRIMER_RIGHT_1_END_STABILITY=2.6900
PRIMER_PAIR_1_COMPL_ANY_TH=21.65
PRIMER_PAIR_1_COMPL_END_TH=19.94
PRIMER_PAIR_1_PRODUCT_SIZE=133
=
"""
        primers = self.reader.entry_to_primers(entry)
        self.assertEquals(len(primers), 2)
        self.assertEquals(primers[1].left_start, '744')


##########################
def suite():
    suite = unittest.TestSuite()
    suite.addTest(unittest.makeSuite(TestBoulderIOReader))
    return suite

if __name__ == '__main__':
    unittest.main()
